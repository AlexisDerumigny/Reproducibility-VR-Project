---
title: "Analysis of dependence between Tracking loss and UX"
date: "2023-04-19"
output:
  html_document:
    toc: true
    toc_depth: 2
---
This file is for the two hypothesis:
- The trackerloss impacts certain factors of the user experience.
The trackerloss initially was expected to impact intuitiveness, perceived errors, input responsiveness, control, self motion compellingness, and the questions on speed.
From the correlation matrix this was further filtered to only test this for Control and Self motion compellingness, since these seemed to give the largest correlations.

- 





To calculate this correlations, we considered taking the separate questions as random effect, similar to the UX calculation. However since there was no surety that the average of the correlations would give a result with the same meaning as the correlation of the averages, the latter option was chosen since this for sure gave the statistical test desired, although with slightly less statistical power. 
cor((x1 + x2 + x3)/3, y) = correlation between averages
1/3(cor(x1, y) + cor(x2, y) + cor(x3, y)) = average of correlations (would give more statistical power treating subquestions as random effect, but possibly does not answer the question whether one UX group correlates with another on average.)



```{r setup}
#install.packages(c("corrplot", "tidyverse", "knitr"))
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, dev = 'svg') # set output device to svg
library(tidyverse)
library(lmerTest)
options(width = 150) # https://bookdown.org/yihui/rmarkdown-cookbook/text-width.html
```


# 1- Data loading and preprocessing


```{r}
source("preparingTrackingLossData.R")
source("preparingUXdata.R")
```


```{r}
dataUXTrackingLoss = full_join(
  x = dataTrackingLoss |> select(! all_of("Index")),
  y = dataUX |> mutate(ParticipantID = as.integer(ParticipantID)),
  by = c("ParticipantID", "LocomotionTechnique"),
  suffix = c(".x", ".y"),
  keep = NULL
)
```


# 2- Visualization

```{r}
allQuestionsGroups = unique(data_questions$QuestionGroup)
for (i_QuestionGroup in 1:length(allQuestionsGroups))
{
  nameQuestionGroup = allQuestionsGroups[i_QuestionGroup]
  selectedQuestions = data_questions[
    data_questions$QuestionGroup == nameQuestionGroup, ]
  
  nameQuestions = selectedQuestions$Question_description
  
  df_selectCol = dataUXTrackingLoss[, nameQuestions, drop = FALSE]
  for (i_Question in 1:length(nameQuestions)){
    nameOfQuestion = nameQuestions[i_Question]
    if (selectedQuestions[i_Question, "ToBeInverted"] == 0){
      df_selectCol[, nameOfQuestion] = - abs(3 - df_selectCol[, nameOfQuestion])
    }
  }
  
  dataUXTrackingLoss[, nameQuestionGroup] = rowMeans(df_selectCol)
}
```


```{r, fig.height=12, fig.width=12}
dataUXTrackingLoss$NrTrackerlossesOp = - dataUXTrackingLoss$NrTrackerlosses #invert, so better = less tracker losses

selectedQuestions = c(allQuestionsGroups, "NrTrackerlossesOp",
                      "I think the virtual speed felt natural compared to normal walking",
                      "I wanted to move through the virtual environment")

corMat = cor(dataUXTrackingLoss[, selectedQuestions], use = "pairwise.complete.obs")
corrplot::corrplot(corMat, order = "hclust")
```

```{r, fig.height=10, fig.width=10}
ggplot(dataUXTrackingLoss) +
  geom_jitter(aes(Satisfaction, Intuitiveness), width = 0.1, height = 0.1)
  
dataUXTrackingLoss |>
  mutate(ParticipantID = factor(ParticipantID)) |>
  ggplot() +
  geom_jitter(aes(Satisfaction, Intuitiveness, color = ParticipantID), width = 0.1, height = 0.1)

dataUXTrackingLoss |>
  mutate(ParticipantID = factor(ParticipantID)) |>
  ggplot() +
  geom_jitter(aes(Satisfaction, Intuitiveness), width = 0.01, height = 0.01) +
  facet_wrap(~ ParticipantID)
  
```


```{r, fig.height=12, fig.width=12}
corTests = dataUXTrackingLoss[, selectedQuestions] |> 
  corrplot::cor.mtest(use = "pairwise.complete.obs")

corrplot::corrplot(corMat, p.mat = corTests$p, sig.level = 0.05, order = "hclust",
                   addrect = 2)
```
```{r}
print(dataUXTrackingLoss$`Self-motion compellingness`)
```

```{r}
#trying to get the answer: are the Nr of TrackerLosses significantly correlated with Control and self-motion compellingness.

#library(lme4)
regtrackUXcor <- lmer(data = dataUXTrackingLoss, NrTrackerlosses ~ Control + `Self-motion compellingness` + (1 | ParticipantID) + (1|LocomotionTechnique))
summary(regUXcor)
```

```{r}
# this is trying to use emmeans copying what is already there in the other projects, but I don't think this is the way to do that with multiple fixed conditions
regtrackUXcor_emmeans = emmeans::emmeans(regtrackUXcor, ~  Control + `Self-motion compellingness`)
pairs(regtrackUXcor_emmeans, adjust = "bonferroni")
```


# 3- Modeling



